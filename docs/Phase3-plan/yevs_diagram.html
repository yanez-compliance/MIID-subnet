<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YEVS Data Pipeline Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .mermaid {
            text-align: center;
            overflow-x: auto;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        .description {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .description h3 {
            color: #007bff;
            margin-top: 0;
        }
        .toggle-buttons {
            text-align: center;
            margin-bottom: 30px;
        }
        .toggle-btn {
            background-color: #f8f9fa;
            border: 2px solid #007bff;
            color: #007bff;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .toggle-btn:hover {
            background-color: #e3f2fd;
        }
        .toggle-btn.active {
            background-color: #007bff;
            color: white;
        }
        .yevs-description {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .yevs-description h2 {
            color: #007bff;
            margin-top: 0;
        }
        .yevs-description h3 {
            color: #007bff;
            margin-top: 0;
        }
        .yevs-intro {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .capability-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .capability-icon {
            font-size: 2.5em;
            margin-right: 15px;
            color: #007bff;
        }
        .capability-content h4 {
            color: #333;
            margin-top: 0;
            margin-bottom: 5px;
        }
        .capability-content p {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 0;
        }
        .yevs-purpose {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Subnet 54 Data Post-processing Pipeline Architecture</h1>
        
        
        <div class="toggle-buttons">
            <button id="compactBtn" class="toggle-btn active" onclick="showCompact()">Compact View</button>
            <button id="detailedBtn" class="toggle-btn" onclick="showDetailed()">Detailed View</button>
            <button id="databaseBtn" class="toggle-btn" onclick="showDatabase()">Database View</button>
            <button id="erDiagramBtn" class="toggle-btn" onclick="showERDiagram()">ER Diagram</button>
            <button id="apiEndpointsBtn" class="toggle-btn" onclick="showAPIEndpoints()">API Endpoints</button>
            <button id="yevsProcessingBtn" class="toggle-btn" onclick="showYEVSProcessing()">YEVS Processing</button>
            <button id="yevsReputationBtn" class="toggle-btn" onclick="showYEVSReputationProcessing()">Reputation Processing</button>
            <button id="validatorWorkflowBtn" class="toggle-btn" onclick="showValidatorWorkflow()">Validator Workflow</button>
            <button id="uavFlowBtn" class="toggle-btn" onclick="showUAVFlow()">UAV Flow</button>
            <button id="reputationFlowBtn" class="toggle-btn" onclick="showReputationFlow()">Reputation Flow</button>
            <button id="ldsSystemBtn" class="toggle-btn" onclick="showLDSSystem()">LDS System</button>
        </div>
        
        <div id="detailedDiagram" class="mermaid" style="display: none;">
flowchart LR
  %% Input Sources
  subgraph Inputs [Data Sources]
    M["Miners<br/>(name variations)"]
    V["Validators<br/>(JSON results)"]
  end

  %% Raw Ingestion
  subgraph Raw [Raw Data Storage]
    RAW["Raw JSON"]
  end

  %% Processing
  subgraph Processing [Processing Pipeline]
    direction TB
    ETL["ETL <br/>Pipeline <br/> (normalize, dedup,<br/>upsert)"]
    YEVSWorker["YEVS Pipeline"]
  end

  %% Storage
  subgraph DBLayer [Database Layer]
    direction TB
    Seeds["seeds"]
    Vars["variations"]
    Metrics["YEVS Metrics"]
    Subs["observations"]
  end

  %% APIs
  subgraph APIs [API Services]
    direction TB
    YanezAPI["Yanez API"]
    ValidatorAPI["Validator API"]
  end

  %% Data Flow
  M --> V
  V --> RAW
  RAW --> ETL
  
  ETL --> Seeds
  ETL --> Vars
  ETL --> Subs

  Seeds --> YEVSWorker
  Vars --> YEVSWorker
  YEVSWorker --> Metrics

  DBLayer --> APIs

  %% Styling
  classDef inputs fill:#e3f2fd,stroke:#333,stroke-width:2px;
  classDef raw fill:#f5f5f5,stroke:#333,stroke-width:2px;
  classDef processing fill:#ede7f6,stroke:#333,stroke-width:2px;
  classDef db fill:#e8f5e9,stroke:#333,stroke-width:2px;
  classDef apis fill:#fff3e0,stroke:#333,stroke-width:2px;

  class M,V inputs;
  class RAW raw;
  class ETL,YEVSWorker processing;
  class Seeds,Vars,Subs,Metrics db;
  class YanezAPI,ValidatorAPI apis;
        </div>

        <div id="compactDiagram" class="mermaid">
flowchart LR
  %% Inputs
  M["Miners"] --> V["Validators"]
  V --> RAW["Raw Phase"]
  
  %% Core Processing
  RAW --> ETL["ETL"]
  ETL --> DB["DB Layer"]
  
  %% YEVS processing integrated
  ETL --> YEVS["YEVS Models"]
  YEVS --> DB
  
  %% APIs connect to DB
  DB --> YanezAPI["Yanez API"]
  DB --> ValidatorAPI["Validator API"]
        </div>

        <div id="databaseDiagram" class="mermaid" style="display: none;">
graph TD

    %% Input Stage
    A1["JSON Files <br/> samples/*.json"] --> B1["Adapter Registry </b> <br/> generic_responses_v1.py <br/> labeled_seeds_v1.py"]
    A2["Labeled Seeds JSON <br/> seed_names_with_labels"] --> B1

    %% Sample Input Data
    A1 -.-> A1_sample["{
  'seed': 'Anna Smith',
  'variations': [
    {'text': 'Ana Smith',
     'score': 0.95,
     'miner_ext_id': 'm2'}
  ]
}"]
    A2 -.-> A2_sample["{
  'seed_names_with_labels': [
    {'name': 'John Doe',
     'label': 'positive'},
    {'name': 'Jane Smith',
     'label': 'negative'}
  ]
}"]

    %% Processing Pipeline
    B1 --> C1["Text Normalization</b> <br/> normalize/text.py"]
    C1 --> C2["Validation Pipeline</b> <br/> ingest/validate.py"]
    C2 --> C3["Batch Processing</b> <br/> ingest/batch.py <br/> (direct label in seed)"]

    %% YEVS Processing Integration
    C3 --> Y1["YEVS Processor"]
    Y1 --> Y2["Open Source Similarity Engine and Weighted Fusion"]
    Y1 --> Y3["YANEZ Similarity Engine"]
    Y2 --> Y4["Fuzzy level classification"]
    Y3 --> Y4

    %% Database Layer - ORM and Storage
    C3 --> D1["SQLAlchemy 2.0 ORM </b> <br/> db/models.py"]
    D1 --> E1["Idempotent Operations </b> <br/> get_or_create patterns"]
    Y4 --> E1
    
    %% Database Schema - All 7 tables including YEVS with integrated labeling
    E1 --> F1["PostgreSQL Database"]
    F1 --> T1["seeds table </b> <br/> (id, seed_text, normalized_seed, seed_hash, <br/> label [positive/negative])"]
    F1 --> T2["variations table</b> <br/> (id, seed_id, variation_text, normalized_variation)"]  
    F1 --> T3["miners table </b> <br/> (id, miner_external_id, display_name)"]
    F1 --> T4["batches table </b> <br/> (id, batch_name, source_system)"]
    F1 --> T5["source_files table </b> <br/> (id, batch_id, file_path, checksum)"]
    F1 --> T6["observations table </b> <br/> (id, seed_id, variation_id, miner_id)"]
    F1 --> T7["yevs_metrics table </b> <br/> (all similarity scores, fuzzy levels, processing metadata)"]
    F1 --> T8["validators table </b> <br/> (id, validator_external_id)"]
    F1 --> T9["labels table</b> <br/> (variation_count, phonetic_similitary, orthographic_similitary)"]
    F1 --> T10["queries table </b> <br/> (query_text)"]
    F1 --> T11["rules table </b> <br/> (rule_name, description)"]

    %% Metrics Collection (parallel to storage)
    C3 --> M1["Metrics Collection </b> <br/> (ingest/metrics.py)"]
    M1 --> M2["Processing Stats"]

    %% Access Layer - API Path
    F1 --> G1["FastAPI Application </b> <br/> api/main.py"]
    G1 --> G2["Seeds Router </b> <br/> api/routers/seeds.py"]
    G1 --> G3["YEVS Router </b> <br/> api/routers/yevs.py"]
    G2 --> H1["POST /seeds/exists"]
    G2 --> H2["POST /seeds/diff"]
    G3 --> H4["GET /yevs/metrics/{seed_id}"]
    G3 --> H5["POST /yevs/query/fuzzy"]
    G3 --> H6["GET /yevs/statistics/coverage"]
    G3 --> H7["POST /yevs/analysis/gaps"]
    G3 --> H8["GET /yevs/search"]
    G3 --> H9["POST /yevs/balanced-dataset"]
    G2 --> H3["GET /docs"]

    %% Access Layer - CLI Path  
    F1 --> I1["CLI Interface </b> <br/> ingest/cli.py"]
    I1 --> I2["ingest command </b> <br/> with YEVS processing"]
    I2 --> C3

    %% Query Processing
    H1 --> J1["Batch Seed Lookup </b> <br/> Efficient hash-based queries"]
    H2 --> J2["Variation Comparison </b> <br/> Existing vs new analysis"]
    H4 --> J3["YEVS Metrics Retrieval </b> <br/> Seed-specific analysis"]
    H5 --> J4["Fuzzy Level Filtering </b> <br/> Weighted vs Yanez methods"]
    H6 --> J5["Coverage Statistics </b> <br/> Distribution analysis"]
    H7 --> J6["Gap Analysis </b> <br/> Dimension coverage gaps"]
    H8 --> J7["Score Range Search </b> <br/> Targeted similarity queries"]
    H9 --> J8["Balanced Dataset Retrieval </b> <br/> Positive/negative sampling"]

    %% Output Layer
    J1 --> K1["Existence Response </b> <br/> {'Michael': true, 'sarah': false}"]
    J2 --> K2["Diff Response </b> <br/> {'existing': ['Mikel'], 'new': ['Mychal']}"]
    J3 --> K4["YEVS Metrics Response </b> <br/> All similarity scores + fuzzy levels"]
    J4 --> K5["Fuzzy Level Results </b> <br/> Filtered by classification"]
    J5 --> K6["Coverage Statistics </b> <br/> Distribution + averages"]
    J6 --> K7["Gap Analysis </b> <br/> Recommendations + needed samples"]
    J7 --> K8["Score Search Results </b> <br/> Ranked by similarity"]
    J8 --> K9["Balanced Dataset Response </b> <br/> Positive + negative samples + stats"]
    M2 --> K3["Ingestion Report"]

    %% Styling
    classDef inputFiles fill:#e1f5fe,stroke:#000;
    classDef processing fill:#f3e5f5,stroke:#000;
    classDef yevs fill:#fff3e0,stroke:#000;
    classDef database fill:#e8f5e8,stroke:#000;
    classDef api fill:#fff3e0,stroke:#000;
    classDef cli fill:#fce4ec,stroke:#000;
    classDef metrics fill:#e8eaf6,stroke:#000;
    classDef output fill:#e0f2f1,stroke:#000;

    class A1,A2,A1_sample inputFiles
    class B1,C1,C2,C3,D1,E1 processing
    class Y1,Y2,Y3,Y4 yevs
    class F1,T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11 database
    class G1,G2,G3,H1,H2,H3,H4,H5,H6,H7,H8,H9,J1,J2,J3,J4,J5,J6,J7,J8 api
    class I1,I2 cli
    class M1,M2 metrics
    class K1,K2,K3,K4,K5,K6,K7,K8,K9 output
        </div>

        <div id="erDiagram" class="mermaid" style="display: none;">

erDiagram
	direction TB
    IDENTITY {
        BIGINT id PK
        BIGINT seed_name_id FK
        BIGINT seed_address_id FK
        BIGINT seed_dob_id FK
        TEXT label
        BIGINT list_id
        BIGINT list_name
        DATETIME created_at
    }

    IDENTITY||--o{SEED_ADDRESS:"  "
	IDENTITY||--o{SEED_DOB:"  "
	IDENTITY||--o{SEED_NAME:"  "

    SEED_NAME {
        BIGINT id PK
        TEXT seed_text
        TEXT normalized_seed
        TEXT seed_hash
        TEXT script
        DATETIME created_at
    }

	SEED_NAME||--o{NAME_VARIATIONS:"  "
	SEED_NAME||--o{YEVS_METRICS:"  "

    SEED_ADDRESS {
        BIGINT id PK
        TEXT seed_text
        TEXT normalized_seed
        TEXT seed_hash
        TEXT script
        TEXT risk_index
        DATETIME created_at
    }

    SEED_ADDRESS||--o{ADDRESS_VARIATIONS:"  "
	SEED_ADDRESS||--o{UAV_ADDRESS:"  "

    SEED_DOB {
        BIGINT id PK
        TEXT seed_text
        TEXT normalized_seed
        TEXT seed_hash
        DATETIME created_at
    }

    SEED_DOB||--o{DOB_VARIATIONS:"  "

    NAME_VARIATIONS {
        BIGINT id PK
        BIGINT seed_name_id FK
        TEXT variation_text
        TEXT normalized_variation
        TEXT variation_hash
        DATETIME created_at
    }

    NAME_VARIATIONS||--o{OBSERVATION:"  "
	NAME_VARIATIONS||--o{YEVS_METRICS:"  "
    NAME_VARIATIONS||--o{VARIATION_RULES:"  "
    
    ADDRESS_VARIATIONS {
        BIGINT id PK
        BIGINT seed_address_id FK
        TEXT variation_text
        TEXT normalized_variation
        TEXT variation_hash
        DATETIME created_at
    }

    ADDRESS_VARIATIONS||--o{OBSERVATION:"  "

    DOB_VARIATIONS {
        BIGINT id PK
        BIGINT seed_dob_id FK
        TEXT variation_text
        TEXT normalized_variation
        TEXT variation_hash
        DATETIME created_at
    }

    DOB_VARIATIONS||--o{OBSERVATION:"  "

    UAV_ADDRESS {
        BIGINT id PK
        BIGINT seed_address_id FK
        TEXT uav_text
        TEXT label
        FLOAT longitude
        FLOAT altitude
        BOOLEAN validate_flag
        BOOLEAN auto_LDS_label
        TEXT geo_primary_provider
        TEXT auto_geo_primary_address_based_lat_long
        TEXT auto_geo_primary_address_based_text
        JSONB auto_geo_primary_meta_data_based_lat_long
        JSONB auto_geo_primary_meta_data_based_text
        TEXT geo_secondary_provider
        TEXT auto_geo_secondary_address_based_lat_long
        TEXT auto_geo_secondary_address_based_text
        JSONB auto_geo_secondary_meta_data_based_lat_long
        JSONB auto_geo_secondary_meta_data_based_text
        BIGINT auto_geo_confidence
        BOOLEAN auto_geo_agreement
        TEXT auto_similarity_method
        FLOAT auto_similarity_score
        BOOLEAN is_duplicate
        DATETIME validated_at
        TEXT validation_status
        BIGINT reviewer_id FK
        TEXT reviewer_feedback
        TEXT agent_feedback
        TEXT comment
        FLOAT score_hint
        BIGINT validation_score
        TEXT cycle_id
        TEXT normalized_uav
        FLOAT auto_honesty_score
        JSONB auto_llm_check_results
        TEXT uav_text_translation
        TEXT primary_address_translation
        DATETIME rep_processed_at
        DATETIME created_at
    }

    UAV_ADDRESS||--o{UAV_OBSERVATION:"  "
    UAV_ADDRESS||--o{SOURCE_FILE:"  "
    UAV_ADDRESS||--o{REVIEWER:"  "

    MINER {
        BIGINT id PK
        TEXT hotkey
        TEXT coldkey
        TEXT display_name
        JSONB meta
        TEXT ip
        DATETIME created_at
    }

    MINER||--o{OBSERVATION:"  "
	MINER||--||MINER_REPUTATION:"  "
	MINER||--o{MINER_REPUTATION_HISTORY:"  "

    BATCH {
        BIGINT id PK
        TEXT batch_name
        TEXT source_system
        DATETIME ingested_at
        JSONB meta
    }

    BATCH||--o{SOURCE_FILE:"  "

    SOURCE_FILE {
        BIGINT id PK
        BIGINT batch_id FK
        TEXT file_path
        TEXT file_checksum
        BIGINT record_count
        DATETIME processed_at
    }

    SOURCE_FILE||--o{OBSERVATION:"  "

    YEVS_METRICS {
        BIGINT id PK
        BIGINT seed_id FK
        BIGINT variation_id FK
        FLOAT bert_similarity
        FLOAT fasttext_similarity
        FLOAT rapidfuzz_similarity
        FLOAT tfidf_similarity
        FLOAT levenshtein
        FLOAT jaro_winkler
        FLOAT metaphone
        FLOAT soundex
        FLOAT yanez_similarity
        BOOLEAN yanez_decision
        FLOAT text_score
        FLOAT sound_score
        VARCHAR fuzzy_level_weighted
        VARCHAR fuzzy_level_yanez
        INTEGER processing_time_ms
        VARCHAR model_version
        JSONB meta
        DATETIME created_at
        DATETIME updated_at
    }

    OBSERVATION {
        BIGINT id PK
        BIGINT variation_name_id FK
        BIGINT variation_address_id FK
        BIGINT variation_dob_id FK
        BIGINT miner_id FK
        BIGINT validator_id FK
        BIGINT query_id FK
        BIGINT label_id FK
        BIGINT source_file_id FK
        DATETIME observed_at
    }
	
    UAV_OBSERVATION {
        BIGINT id PK
        BIGINT uav_id FK
        BIGINT miner_id FK
        BIGINT source_id FK
        TEXT cycle_id
        BOOLEAN is_duplicated
        DATETIME rep_processed_at
        DATETIME observed_at
    }

    UAV_OBSERVATION||--o{MINER:"  "
    UAV_OBSERVATION||--o{SOURCE_FILE:"  "

    VALIDATOR {
        BIGINT id PK
        TEXT hotkey
        DATETIME created_at
    }

    VALIDATOR||--o{OBSERVATION:"  "

    QUERY {
        BIGINT id PK
        TEXT query_text
        TEXT query_hash
        DATETIME created_at
    }

    QUERY||--o{OBSERVATION:"  "

    LABEL {
        BIGINT id PK
        BIGINT variation_count
        JSONB phonetic_similitary
        JSONB orthographic_similitary
        DATETIME created_at
    }

    LABEL||--o{OBSERVATION:"  "

    RULE {
        BIGINT id PK
        TEXT rule_name
        TEXT description
    }

    RULE||--o{VARIATION_RULES:"  "

    VARIATION_RULES {
        BIGINT id PK
        BIGINT variation_id FK
        BIGINT rule_id FK
    }

    MINER_REPUTATION {
        BIGINT id PK
        BIGINT miner_id FK
        FLOAT rep_score
        TEXT rep_tier
        BIGINT total_uavs_validated
        BIGINT total_duplicates
        BIGINT total_cheats
        FLOAT last_delta
        TEXT last_reason
        FLOAT total_score
        DATETIME last_updated_at
        DATETIME created_at
    }

    MINER_REPUTATION_HISTORY {
        BIGINT id PK
        BIGINT miner_id FK
        TEXT cycle_id
        BIGINT uav_id FK
        BIGINT delta
        TEXT reason
        FLOAT rep_score_before
        FLOAT rep_score_after
        TEXT auto_source
        DATETIME created_at
    }

    REVIEWER {
        BIGINT id PK
        TEXT username
        TEXT password
        DATETIME created_at
    }
	
    
</div>

        <div id="apiEndpointsDiagram" class="mermaid" style="display: none;">
graph LR
    subgraph SEED_API["Seeds API (/seeds)"]
        SA1["POST /seeds/exists<br/>Check seed existence"]
        SA2["POST /seeds/diff<br/>Compare variations"]
        SA3["GET /seeds/labels<br/>Get seed labels (positive/negative)"]
    end
    
    subgraph YEVS_API["YEVS API (/yevs)"]
        YA1["GET /yevs/metrics/{seed_id}<br/>Get all metrics for seed"]
        YA2["POST /yevs/query/fuzzy<br/>Filter by fuzzy level"]
        YA3["GET /yevs/statistics/coverage<br/>Coverage & distribution stats"]
        YA4["POST /yevs/analysis/gaps<br/>Identify dimension gaps"]
        YA5["GET /yevs/search<br/>Search by score range"]
        YA6["POST /yevs/balanced-dataset<br/>Get balanced positive/negative samples"]
    end
    
    subgraph USES["Use Cases & Features"]
        UC1["Batch Seed Validation<br/>Efficient hash-based lookup"]
        UC2["Variation Comparison<br/>Existing vs new analysis"]
        UC3["Comprehensive Metrics<br/>All similarity scores + fuzzy levels"]
        UC4["Fuzzy Classification<br/>Weighted vs Yanez methods"]
        UC5["Quality Assessment<br/>Distribution analysis & averages"]
        UC6["Gap Detection<br/>Underrepresented dimensions"]
        UC7["Targeted Search<br/>Score-based filtering"]
        UC8["Seed Classification<br/>Positive/negative labeling"]
        UC9["Balanced Dataset Generation<br/>For model training & testing"]
    end
    
    subgraph MODELS["Scoring Models"]
        M1["Open Source Similarity Engine<br/>Weighted Fusion of:<br/>BERT, FastText, TFIDF, RapidFuzz<br/>Levenshtein, Jaro-Winkler<br/>+ Phonetic (Soundex, Metaphone)"]
        M2["YANEZ Similarity Engine<br/>Custom Neural Network (V19f.keras)<br/>FastText + Neural Architecture<br/>Independent Classification"]
        M3["Composite Scoring<br/>Text + Sound scores<br/>Fuzzy level classification"]
    end
    
    SA1 --> UC1
    SA2 --> UC2
    SA3 --> UC8
    YA1 --> UC3
    YA2 --> UC4
    YA3 --> UC5
    YA4 --> UC6
    YA5 --> UC7
    YA6 --> UC9
    
    UC3 --> M1
    UC3 --> M2
    UC4 --> M3
    UC5 --> M3
    UC6 --> M3
    UC7 --> M3
        </div>

        <div id="yevsProcessingDiagram" class="mermaid" style="display: none;">
sequenceDiagram
    participant JSON as JSON Files
    participant CLI as CLI/Batch Processor
    participant ING as Ingestion Pipeline
    participant PROC as YEVS Processor
    participant POLY as Open Source Similarity Engine
    participant YANEZ as YANEZ Similarity Engine
    participant DB as PostgreSQL DB
    participant API as FastAPI Server
    
    Note over JSON,DB: Integrated YEVS Processing Pipeline
    
    JSON->>CLI: Load seed-variation data
    CLI->>ING: Parse and validate (with labels)
    ING->>DB: Create/get Seed records (with label field)
    ING->>DB: Create/get Variation records
    ING->>PROC: Trigger YEVS processing
    
    Note over PROC: Lazy initialization on first use
    PROC->>PROC: Initialize models (if needed)
    PROC->>POLY: prepare_matchers()
    POLY-->>PROC: BERT, FastText, TFIDF, phonetic models
    PROC->>YANEZ: prepare_yanez_model()
    YANEZ-->>PROC: FastText embedder + V19f.keras
    
    Note over PROC,YANEZ: Process seed-variation pair
    PROC->>POLY: compute_similarity_scores(row)
    POLY-->>PROC: BERT, FastText, TFIDF, RapidFuzz<br/>Levenshtein, Jaro-Winkler<br/>Metaphone, Soundex
    
    PROC->>PROC: classify_fuzziness_with_weights()
    PROC-->>PROC: Text + Sound composite scores<br/>Fuzzy level (light/stress)
    
    PROC->>YANEZ: compute_yanez_similarity(row)
    YANEZ-->>PROC: Yanez similarity + decision
    
    PROC->>PROC: classify_fuzziness_with_weights_yanez()
    PROC-->>PROC: Yanez-based fuzzy level
    
    PROC->>DB: Store YEVSMetric record
    DB-->>ING: Processing complete
    
    Note over API,DB: API Access Layer
    API->>DB: Query YEVS metrics
    DB-->>API: Return comprehensive metrics<br/>with fuzzy classifications
        </div>

        <div id="yevsReputationProcessingDiagram" class="mermaid" style="display: none;">

sequenceDiagram

    participant REV as Manual Validation UI

    participant DB as Postgres DB

    participant REP as Reputation Engine Job

    participant FLASK as Flask App (Reputation API)

    participant VAL as Validator Node

    Note over REV,DB: Manual validation phase

    REV->>DB: Update UAV rows<br/>(validation_score, comment,<br/>status=reviewed)

    Note over DB,REP: Batch reputation update (e.g. daily / per cycle)

    REP->>DB: Read reviewed UAVs

    REP->>DB: Compute deltas &<br/>update miner_reputation

    REP->>DB: Append entries to<br/>miner_reputation_history

    Note over FLASK,DB: Hourly reputation snapshot

    FLASK->>DB: Fetch miner_reputation table

    DB-->>FLASK: Current rep scores<br/>for all miners

    FLASK->>FLASK: Cache snapshot in memory<br/>with snapshot_version

    Note over VAL,FLASK: Validator asks for reputation

    VAL->>FLASK: POST /reputation_request<br/>(batch miner scores)

    FLASK-->>VAL: rep_score, rep_tier<br/>per miner + snapshot_version

    Note over VAL,FLASK: Validator sends final rewards

    VAL->>FLASK: POST /reward_allocation<br/>(per-miner rewards,<br/>snapshot_version)

    FLASK->>DB: Store reward allocations<br/>and metadata

    Note over DB: Reputation for next cycle<br/>will be recomputed from<br/>future manual validation

        </div>

        <div id="validatorWorkflowDiagram" class="mermaid" style="display: none;">

        sequenceDiagram
            autonumber
            participant DB as DB Machine<br/>(Reputation Engine)
            participant FLASK as Flask App<br/>(Core Machine)
            participant VAL as Validator Node
            participant DISK as Validator Disk<br/>(pending_allocations.json)
            participant CHAIN as Bittensor Chain
        
            %% === HOURLY SNAPSHOT GENERATION ===
            Note over DB,FLASK: Hourly: Snapshot Generation (DB Machine)
            DB->>DB: Query MINER_REPUTATION table
            DB->>FLASK: Push reputation_snapshot.json
            FLASK->>FLASK: load_reputation_snapshot()<br/>Update CURRENT_REP_SNAPSHOT
        
            %% === VALIDATOR STARTUP ===
            Note over VAL,DISK: Validator Startup (once)
            VAL->>DISK: Load pending_allocations.json?
            alt Pending file exists (previous failure)
                DISK-->>VAL: Return pending allocations list
                VAL->>VAL: Log: "Loaded N pending allocations"
            else No pending file
                VAL->>VAL: _pending_allocations = []
            end
        
            %% === FORWARD PASS LOOP ===
            loop Every Forward Pass (~45-55 min)
                Note over VAL: Calculate Rewards
                VAL->>VAL: Query miners for KAV variations
                VAL->>VAL: get_name_variation_rewards() → Q scores
                VAL->>VAL: apply_reputation_rewards(Q, cached_rep)<br/>→ final rewards with burn
        
                Note over VAL,CHAIN: Set Weights On-Chain
                VAL->>CHAIN: set_weights(final_rewards, final_uids)
                CHAIN-->>VAL: Transaction confirmed
        
                Note over VAL,DISK: Prepare Upload with Pending Queue
                VAL->>VAL: Add new allocation to _pending_allocations
                VAL->>DISK: Save pending to disk (backup)
                VAL->>VAL: Build payload with ALL pending allocations
        
                Note over VAL,FLASK: Upload Results + Get Rep Cache
                VAL->>FLASK: POST /upload_data/{hotkey}<br/>{allocations: [...], pending_count: N}
        
                alt Flask responds successfully
                    FLASK->>FLASK: Verify signature
                    FLASK->>FLASK: Save results JSON
                    FLASK->>FLASK: Save each allocation to data/rewards/
                    FLASK-->>VAL: {rep_cache: {...}, rep_snapshot_version}
                    VAL->>VAL: Cache rep_data for next pass
                    VAL->>VAL: Clear _pending_allocations
                    VAL->>DISK: Write empty [] to pending file
                else Flask unreachable / error
                    VAL->>VAL: Keep using cached rep_data
                    VAL->>VAL: Pending stays (retry next pass)
                    Note over VAL: pending_count increases each pass
                end
            end
        
            %% === DB FEEDBACK LOOP (V2) ===
            Note over FLASK,DB: Feedback Loop: Reward Data → DB (V2)
            FLASK->>DB: Send reward allocation files
            DB->>DB: Decrease rep_score for rewarded miners
            DB->>DB: Log to MINER_REPUTATION_HISTORY
        </div>

        <div id="uavFlowDiagram" class="mermaid" style="display: none;">

flowchart TB
    A1["Phase3-C1-Exec 
    (Nov 20 - Dec 19)
    Last Update: Dec 19"]:::Blue
    A1 --> A2["226124 UAVs (100%)"]:::Blue

    A(["Start"]):::Sky --> n35["is duplicate"]:::Peach

    n35 --> n36["auto score = -3"]:::Rose
    n36 --> s1["33524 uavs (14.83%)"]:::Blue
    
    n35 --> n37["is recycled<br/>similarity > 0.75<br/>detected by fuzzy matching Trigram similarity (PostgreSQL: pg_trgm extension)"]:::Peach
    n37 --> n38["auto score = -3"]:::Rose
    n38 --> s2["114957 uavs (50.84%)"]:::Blue

    n37 --> n26["light filtering; semantic noise check<br/>(is_semantic_text)"]:::Peach
    n26 --> n27["spam data, auto score = -5"]:::Rose
    n27 --> s3["3061 uavs (1.35%)"]:::Blue
    n26 --> n32["coords in correct country<br/>(predefined boundaries)"]:::Peach
    n32 --> n33["lon/lat outside boundaries → auto score = 0"]:::Rose
    n33 --> s4["20430 uavs (9.03%)"]:::Blue
    n32 --> B["Miner address to Nominatim API<br/>(text-based search)"]:::Peach

    B --> C["pass, miners coords are in the boundary box"]:::Ash
    B --> D["fails or no results<br/>(or coords outside bbox)"]:::Aqua

    C --> n5["Reject UAV, auto score = 0<br/>(Not a UAV)"]:::Rose
    n5 --> s5["29546 uavs (13.07%)"]:::Blue

    D --> n1["Miner (lat, lon) to Nominatim API<br/>(reverse geocode, language-aware)"]:::Peach

    n1 --> n2["pass"]:::Aqua
    n1 --> n3["fails"]:::Aqua

    n2 --> n6["compare miner address to Nominatim address<br/>(rapidfuzz: token_set_ratio, token_sort_ratio)"]:::Peach
    n6 --> n10["hard-code relative match<br/>(token_set_ratio >= 70 and diff < 25)"]:::Peach
    n6 --> n11["no match"]:::Aqua

    n10 --> n30["auto points = 2<br/>(auto_scored, continue)"]:::Pine
    n30 --> s6["9104 uavs (4.03%)"]:::Blue

    n11 --> n40["compare with bert similarity using embeddings"]:::Peach
    n40 --> n41["pass (bert_similarity > 0.8)"]:::Aqua
    n40 --> n42["fails"]:::Aqua
    n41 --> n43["auto points = 2<br/>(auto_scored, continue)"]:::Pine
    n43 --> s7["8037 uavs (3.55%)"]:::Blue
    n42 --> n4["Miner (lat, lon) to Opencage API"]:::Peach

    n3 --> n4

    n4 --> n8["fails (no results)"]:::Aqua
    n4 --> n9["pass (results found)"]:::Aqua

    n8 --> n8a["reject UAV, auto score = -5<br/>(No address found)"]:::Rose

    n9 --> n13["Miner address to Opencage API<br/>(text-based search)"]:::Peach
    n13 --> n13b["pass or fails<br/>(results stored)"]:::Aqua
    n13b --> n20["processed status<br/>(ready for manual validation)"]:::Pine
    n20 --> s8["7440 uavs (3.29%)"]:::Blue

    classDef Sky stroke:#374D7C, fill:#E2EBFF, color:#374D7C;
    classDef Aqua stroke:#46EDC8, fill:#DEFFF8, color:#378E7A;
    classDef Peach stroke:#FBB35A, fill:#FFEFDB, color:#8F632D;
    classDef Pine stroke:#254336, fill:#27654A, color:#FFFFFF;
    classDef Ash stroke:#999999, fill:#EEEEEE, color:#000000;
    classDef Rose stroke:#FF5978, fill:#FFDFE5, color:#8E2236;
    classDef Blue stroke:#374D7C, fill:#E2EBFF, color:#374D7C;
        </div>
    </div>

    <div id="reputationFlowDiagram" class="mermaid" style="display: none;">

        flowchart TB
            A(["Start"]) --> B["Get scored UAVs from the database, and rep_processed_at IS NULL"]
            B --> C["For each miner"]
            C --> D{"Does the miner have a MINER REPUTATION row?"}
            D --> E["NO"] & F["YES"]
            E --> G["Create row
                rep_before_score = 1.0
                rep_tier = Neutral"]
            F --> H["Get row"]
            G --> I["delta_total = Sum all Δrep
            rep_score_after = rep_score = max(0.10, min(rep_score_before + delta_total, 9999.0))"]
            H --> I
            I --> J["Update tier based on
                Tier Boundaries (V1)"]
            J --> K["Insert MINER_REPUTATION_HISTORY row"]
            K --> L["Upsert MINER_REPUTATION"]
            L --> M["Update processed UAVs
            rep_processed_at = NOW()"]
            M --> N
            N(["End"])

    </div>

    <div id="ldsSystemDiagram" class="mermaid" style="display: none;">
flowchart TD
    A[Input Miner Address Data] --> B{is_semantic_text<br/>Spam Check}
    
    B -- Not Semantic --> C[❌ NOT Valid<br/>Non-semantic text]
    B -- Is Semantic --> D[verify_address<br/>Direct KAV Lookup]
    
    D -- Valid --> E[✅ Yes - High Risk<br/>KAV validation successful]
    D -- Not Found --> F[Split Address by Comma<br/>Remove Duplicates]
    
    F --> G[spell_check<br/>Get Corrected Address]
    
    G --> H[verify_address<br/>Direct KAV Lookup on Corrected]
    
    H -- Valid --> I[✅ Yes - High Risk<br/>KAV validation successful for spell-checked address]
    H -- Not Found --> J[Split Corrected Address<br/>Remove Duplicates]
    
    J --> K[Generate Address Combinations<br/>Example: gogirls ict initiative, 46th street, munuki hai gezira, munuki, juba, S.S.]
    
    K --> K1[gogirls ict initiative]
    K --> K2[gogirls ict initiative, 46th street]
    K --> K3[gogirls ict initiative, 46th street, munuki hai gezira]
    K --> K4[gogirls ict initiative, 46th street, munuki hai gezira, munuki]
    K --> K5[gogirls ict initiative, 46th street, munuki hai gezira, munuki, juba]
    K --> K6[gogirls ict initiative, 46th street, munuki hai gezira, munuki, juba, S.S.]
    
    K1 --> M{For Each Candidate<br/>combination, single_part}
    K2 --> M
    K3 --> M
    K4 --> M
    K5 --> M
    K6 --> M
    
    M --> N{filter_parts<br/>Valid?}
    
    N -- No --> M
    N -- Yes --> O[verify_address<br/>on Combination]
    
    O -- Valid --> P[✅ Yes - High Risk<br/>Real address, parts is high risk<br/>+ Spell check fix if applicable]
    
    O -- Not Found --> Q{Try Single Part<br/>if different from combination}
    
    Q -- Skip --> M
    Q -- Try --> R{1. filter_parts Valid?<br/>2. place_rank > 25?<br/>Example: removing restaurant names<br/>and street names too local}
    
    R -- Invalid/Not Found/place_rank > 25 --> M
    R -- Valid & place_rank <= 25 --> U[✅ Yes - High Risk<br/>Not real address, parts is high risk<br/>+ Spell check fix if applicable]
    
    M -- All Candidates Tried --> Y[❌ No - Not High Risk<br/>Not a high risk address]
        </div>

    <script>
        mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: 'default',
            flowchart: {
              useMaxWidth: true,
              htmlLabels: true,
              curve: 'basis',
              diagramPadding: 16,
              nodeSpacing: 80,
              rankSpacing: 150
            }
        });

        // Explicit renderer for Mermaid v11
        async function renderMermaid(id) {
          const el = document.getElementById(id);
          if (!el) return;
          if (el.getAttribute('data-rendered')) return;
          try {
            const code = el.textContent.trim();
            const { svg } = await mermaid.render(id + "__svg", code);
            el.innerHTML = svg;
            el.setAttribute('data-rendered', 'true');
          } catch (e) {
            console.error('Mermaid render error for', id, e);
            el.innerText = 'Mermaid render error: ' + (e && e.message ? e.message : e);
          }
        }

        // Pre-render the default (compact) diagram on load
        renderMermaid('compactDiagram');

        async function showDetailed() {
          await renderMermaid('detailedDiagram');
          document.getElementById('detailedDiagram').style.display = 'block';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.add('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showCompact() {
          await renderMermaid('compactDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'block';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.add('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showDatabase() {
          await renderMermaid('databaseDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'block';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.add('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showERDiagram() {
          await renderMermaid('erDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'block';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.add('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showAPIEndpoints() {
          await renderMermaid('apiEndpointsDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'block';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.add('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showYEVSProcessing() {
          await renderMermaid('yevsProcessingDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'block';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.add('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showYEVSReputationProcessing() {
          await renderMermaid('yevsReputationProcessingDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'block';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.add('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showValidatorWorkflow() {
          await renderMermaid('validatorWorkflowDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'block';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.add('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showUAVFlow() {
          await renderMermaid('uavFlowDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'block';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.add('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showReputationFlow() {
          await renderMermaid('reputationFlowDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'block';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.add('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
        }

        async function showLDSSystem() {
          await renderMermaid('ldsSystemDiagram');
          document.getElementById('detailedDiagram').style.display = 'none';
          document.getElementById('compactDiagram').style.display = 'none';
          document.getElementById('databaseDiagram').style.display = 'none';
          document.getElementById('erDiagram').style.display = 'none';
          document.getElementById('apiEndpointsDiagram').style.display = 'none';
          document.getElementById('yevsProcessingDiagram').style.display = 'none';
          document.getElementById('yevsReputationProcessingDiagram').style.display = 'none';
          document.getElementById('validatorWorkflowDiagram').style.display = 'none';
          document.getElementById('uavFlowDiagram').style.display = 'none';
          document.getElementById('reputationFlowDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'none';
          document.getElementById('ldsSystemDiagram').style.display = 'block';
          document.getElementById('detailedBtn').classList.remove('active');
          document.getElementById('compactBtn').classList.remove('active');
          document.getElementById('databaseBtn').classList.remove('active');
          document.getElementById('erDiagramBtn').classList.remove('active');
          document.getElementById('apiEndpointsBtn').classList.remove('active');
          document.getElementById('yevsProcessingBtn').classList.remove('active');
          document.getElementById('yevsReputationBtn').classList.remove('active');
          document.getElementById('validatorWorkflowBtn').classList.remove('active');
          document.getElementById('uavFlowBtn').classList.remove('active');
          document.getElementById('reputationFlowBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.remove('active');
          document.getElementById('ldsSystemBtn').classList.add('active');
        }
    </script>
</body>
</html>
