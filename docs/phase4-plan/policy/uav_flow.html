<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flowchart</title>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 20px;
      background: #f5f7fa;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
  </style>
</head>

<body>
<div class="container">
<h2>Flowchart</h2>

<div class="mermaid">
%%{init:{ "securityLevel":"loose", "flowchart":{ "useMaxWidth":true } }}%%
flowchart TB

    A(["Start"]):::Sky --> n35["is duplicate"]:::Peach

    B["<span>Miner address to Nominatim API address</span>"]:::Peach
        --> C["pass, miners coords are in the boundary box"]:::Ash
        --> D["fails"]:::Aqua
        --> n24["pass, but miner coords outside boundary, added if result exists"]:::Aqua

    D --> n1["Miner (lon, lat) to Nominatim API"]:::Peach
    n1 --> n2["pass"]:::Aqua
    n1 --> n3["fails"]:::Aqua

    n3 --> n4["Miner (lon, lat) + miner address to Opencage API (2 calls)"]:::Peach

    C --> n5["Reject UAV, auto score = 0"]:::Rose

    n2 --> n6["compare miner address to Nominatim address"]:::Peach

    n4 --> n7["fails (based on lon/lat)"]:::Ash
    n4 --> n8["pass (based on lon/lat)"]:::Aqua

    n7 --> n9["reject UAV, auto score = -5"]:::Rose

    n6 --> n10["hard-code relative match (symbol, misspelling…)"]:::Peach
    n6 --> n11["no match"]:::Aqua

    n10 --> n25["pass: practically same, matches description"]:::Aqua
    n10 --> n29["far apart, no relative match"]:::Aqua

    n11 --> n4

    n8 --> n13["LLM compares Opencage, Nominatim (if exists), and miner address"]:::Peach

    n13 --> n20["LLM says spam based on semantics; gives hint score → manual validation"]:::Pine

    n24 --> n1

    n26["light filtering; semantic noise check (e.g. ;lasjdf;lkasjd;lfjk)"]:::Peach
        --> B
        --> n27["spam data, auto score = -5"]:::Rose

    n25 --> n30["auto points = 2 (one word missing/misspelled)"]:::Pine
    n29 --> n4

    n32["coords in correct country (predefined boundaries)"]:::Peach
        --> n26
        --> n33["lon/lat outside boundaries → auto score = 0"]:::Rose

    n35 --> n36["auto score = -3"]:::Rose
    n35 --> n32

    classDef Sky stroke:#374D7C, fill:#E2EBFF, color:#374D7C;
    classDef Aqua stroke:#46EDC8, fill:#DEFFF8, color:#378E7A;
    classDef Peach stroke:#FBB35A, fill:#FFEFDB, color:#8F632D;
    classDef Pine stroke:#254336, fill:#27654A, color:#FFFFFF;
    classDef Ash stroke:#999999, fill:#EEEEEE, color:#000000;
    classDef Rose stroke:#FF5978, fill:#FFDFE5, color:#8E2236;
</div>

</div>

<script>
mermaid.initialize({
  startOnLoad: true,
  securityLevel: 'loose'
});
</script>

</body>
</html>
