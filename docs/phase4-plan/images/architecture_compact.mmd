flowchart LR
    subgraph Online["ONLINE (Immediate)"]
        V["Validator:<br/>Challenge"]
        M["Miner:<br/>KAV + UAV + Images"]
        S["KAV+UAV Score<br/>→ SET WEIGHTS"]
    end

    subgraph Offline["OFFLINE (After ~72 min)"]
        I["Images:<br/>S3 → Decrypt →<br/>Face Score"]
        U["UAV:<br/>JSON → Geo/Dup<br/>Validation"]
        R["Update Reputation<br/>(Next Cycle)"]
    end

    V -->|"Synapse"| M
    M -->|"Response"| S
    S -.->|"S3 refs"| I
    S -.->|"UAV data"| U
    I --> R
    U --> R
    R -.->|"Feeds next"| S

    style V fill:#e0e7ff,stroke:#6366f1
    style M fill:#fef3c7,stroke:#f59e0b
    style S fill:#fee2e2,stroke:#ef4444
    style I fill:#d1fae5,stroke:#10b981
    style U fill:#fce7f3,stroke:#ec4899
    style R fill:#d1fae5,stroke:#10b981
